<mat-form-field appearance="outline" [ngClass]="{'input-margin-top': props['className'] === 'input-margin-top'}">
    <mat-label class="label-autocomplete" [ngClass]="props['className']">{{ label }}
        <span *ngIf="required" class="mat-label-optional">*</span>
        <span *ngIf="tooltip" class="label-tooltip">
            <mat-icon matSuffix [matTooltip]="tooltip">help</mat-icon>
        </span>
    </mat-label>
    <input type="text" matInput [placeholder]="placeholder" [formControl]="formControl" [formlyAttributes]="field"
        (input)="handleFilter($event)" [(ngModel)]="value" [matAutocomplete]="auto" (blur)="onBlur()" #inputTrigger />

    <mat-icon matSuffix [style.visibility]="loading ? 'visible' : 'hidden'">autorenew</mat-icon>
    <mat-icon matSuffix [style.visibility]="!loading && value !== '' ? 'visible' : 'hidden'" (click)="value=''"
        tabindex="0" role="button" class="clear-icon">close</mat-icon>

    <mat-autocomplete #auto="matAutocomplete" id="autocomplete-list" [displayWith]="displayFunction.bind(this)"
        role="listbox" (optionSelected)="onOptionSelected($event)">
        <mat-option *ngFor="let dataItem of data" [value]="dataItem[valueProp]" role="option"
            [attr.aria-selected]="isSelected(dataItem)">
            <ng-container [ngTemplateOutlet]="template"
                [ngTemplateOutletContext]="{ $implicit: dataItem, dataItem: dataItem }">
            </ng-container>
        </mat-option>
    </mat-autocomplete>
</mat-form-field>

<!-- Default template for displaying items -->
<ng-template #defaultTemplate let-dataItem>
    <span class="template">{{ dataItem[labelProp] }}</span>
</ng-template>

<!-- Custom template for accounts -->
<ng-template #accountTemplate let-dataItem>
    <span class="template">{{ dataItem['name'] + ' (' + dataItem['accountCode'] + ')' }}</span>
</ng-template>